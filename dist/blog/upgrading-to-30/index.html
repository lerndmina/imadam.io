<!DOCTYPE html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#E93679 name=theme-color><meta name=darkreader-lock><meta content="I recently upgraded my website to Astro 3.0, here's how I did that." name=description><meta content="ImAdam.io • Upgrading to Astro 3.0 because I can." property=og:title><meta content=website property=og:type><meta content=https://lerndmina.dev/ property=og:url><meta content="I recently upgraded my website to Astro 3.0, here's how I did that." property=og:description><meta content=/assets/img/logos/logo-name-bottom-min-transparent.png property=og:image><meta content=Lerndmina.Dev property=og:site_name><meta content="ImAdam.io • Upgrading to Astro 3.0 because I can." property=twitter:title><meta content=summary_large_image property=twitter:card><meta content=https://lerndmina.dev/ property=twitter:url><meta content="I recently upgraded my website to Astro 3.0, here's how I did that." property=twitter:description><meta content=/assets/img/logos/logo-name-bottom-min-transparent.png property=twitter:image><title>ImAdam.io • Upgrading to Astro 3.0 because I can.</title><meta content=true name=astro-view-transitions-enabled><meta content=swap name=astro-view-transitions-fallback><link href=/_astro/about.c087bbdc.css rel=stylesheet /><script src=/_astro/hoisted.33c3ea92.js type=module></script><style>[data-astro-transition-scope=astro-5m2jsxon-1]{view-transition-name:title-upgrading-to-30}@layer astro{::view-transition-old(title-upgrading-to-30){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}::view-transition-new(title-upgrading-to-30){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back]::view-transition-old(title-upgrading-to-30){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back]::view-transition-new(title-upgrading-to-30){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-5m2jsxon-1],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-5m2jsxon-1]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-5m2jsxon-1],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-5m2jsxon-1]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-5m2jsxon-1],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-5m2jsxon-1]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-5m2jsxon-1],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-5m2jsxon-1]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}</style><style>[data-astro-transition-scope=astro-2kw73nlz-2]{view-transition-name:author-upgrading-to-30}@layer astro{::view-transition-old(author-upgrading-to-30){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}::view-transition-new(author-upgrading-to-30){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back]::view-transition-old(author-upgrading-to-30){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back]::view-transition-new(author-upgrading-to-30){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-2kw73nlz-2],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-2kw73nlz-2]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-2kw73nlz-2],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-2kw73nlz-2]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-2kw73nlz-2],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-2kw73nlz-2]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-2kw73nlz-2],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-2kw73nlz-2]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}</style><style>[data-astro-transition-scope=astro-7xt5eaw6-3]{view-transition-name:img-upgrading-to-30}@layer astro{::view-transition-old(img-upgrading-to-30){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}::view-transition-new(img-upgrading-to-30){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back]::view-transition-old(img-upgrading-to-30){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back]::view-transition-new(img-upgrading-to-30){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-7xt5eaw6-3],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-7xt5eaw6-3]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-7xt5eaw6-3],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-7xt5eaw6-3]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-7xt5eaw6-3],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-7xt5eaw6-3]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-7xt5eaw6-3],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-7xt5eaw6-3]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}</style><style>[data-astro-transition-scope=astro-zscz5gm2-4]{view-transition-name:nav}@layer astro{::view-transition-old(nav){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}::view-transition-new(nav){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back]::view-transition-old(nav){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back]::view-transition-new(nav){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-zscz5gm2-4],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-zscz5gm2-4]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-zscz5gm2-4],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-zscz5gm2-4]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-zscz5gm2-4],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-zscz5gm2-4]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-zscz5gm2-4],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-zscz5gm2-4]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}</style></head><body class="bg-notblack h-screen"><div class="px-1 pb-10" data-astro-transition-scope=astro-zscz5gm2-4 id=content-wrap><div class="font-sans block font-normal h-auto ml-1 mr-auto text-xl"><a class="bg-clip-text bg-gradient-to-r from-notwhite hover:from-gradient1 hover:to-gradient2 link text-transparent to-notwhite font-bold from-gradient1 to-gradient2" href=/ >&lt;ImAdam.io/&gt;</a></div><div class="text-center font-sans md:text-3xl text-2xl text-notwhite"><a class="bg-clip-text bg-gradient-to-r from-notwhite hover:from-gradient1 hover:to-gradient2 link text-transparent to-notwhite px-2" href=/ >Home</a><a class="bg-clip-text bg-gradient-to-r from-notwhite hover:from-gradient1 hover:to-gradient2 link text-transparent to-notwhite px-2" href=/blog/ >Blog</a><a class="bg-clip-text bg-gradient-to-r from-notwhite hover:from-gradient1 hover:to-gradient2 link text-transparent to-notwhite px-2" href=/contact/ >Contact Me</a></div></div><div class="m-auto max-w-4xl"><header><div class="text-center mx-auto container pb-10"><h1 class="pb-1 text-5xl" data-astro-transition-scope=astro-5m2jsxon-1>Upgrading to Astro 3.0 because I can.</h1><p class=text-md data-astro-transition-scope=astro-2kw73nlz-2>by <a class="bg-clip-text bg-gradient-to-r from-notwhite hover:from-gradient1 hover:to-gradient2 link text-transparent to-notwhite" href=/blog/author/adam-b/ >Adam B</a> • 31/08/2023</p><small class=text-sm><a class="bg-clip-text bg-gradient-to-r from-notwhite hover:from-gradient1 hover:to-gradient2 link text-transparent to-notwhite" href=/blog/category/personal/ ># Personal</a></small></div></header><div class="mx-auto flex justify-center overflow-hidden p-10 pt-20 rounded-md"><img alt="Astro 3.0 header image, taken from Astro.build" class=drop-shadow-lg data-astro-transition-scope=astro-7xt5eaw6-3 decoding=async height=643 loading=lazy src=/_astro/astro3.835ac2da_ajCra.avif title="Astro 3.0 header image, taken from Astro.build" width=1200></div><div class="flex justify-center px-16 sm:px-8"><div class="content prose prose-invert"><!-- ! Page content goes here --><h2 id=aaaand-begin>Aaaand Begin!</h2><p></p><p class=text-xs><em>Compulsory introduction for those new to astro</em></p><a class="bg-clip-text bg-gradient-to-r from-notwhite hover:from-gradient1 hover:to-gradient2 link text-transparent to-notwhite" href=https://astro.build target="target=&#34;_blank&#34;">Astro</a> is a fairly new framework for building fast and modern websites with your favorite frontend tools. <a class="bg-clip-text bg-gradient-to-r from-notwhite hover:from-gradient1 hover:to-gradient2 link text-transparent to-notwhite" href=https://astro.build/blog/astro-3/ target="target=&#34;_blank&#34;">Recently, Astro released its version 3.0</a> , which introduced some major changes and improvements. In this post, I will share how I upgraded my website to Astro 3.0 and what challenges I faced and solved along the way. I will also show you some of the features and benefits of using Astro 3.0, such as view transitions &amp; image optimisations.<p></p><p>The first step to upgrade to Astro 3.0 was to update the dependencies in my package.json file. I updated astro, astrojs/mdx, astrojs/tailwind, and tailwindcss to their latest versions. Then I ran <code>yarn</code> to install the updated packages.</p><h2 id=view-transitions>View Transitions</h2><p>I decided to try out the new view transitions feature that Astro 3.0 introduced. View transitions allow you to create smooth animations between pages using the native CSS <code>@view-transition</code> rule. This feature is currently only supported by <a class="bg-clip-text bg-gradient-to-r from-notwhite hover:from-gradient1 hover:to-gradient2 link text-transparent to-notwhite" href=https://caniuse.com/mdn-api_viewtransition target="target=&#34;_blank&#34;">Chromium</a>, but Astro provides a fallback mechanism for other browsers (<em>This didn’t end up working</em>).</p><p>To add it to my website I imported the <code>viewtransitions</code> component from <code>astrojs/viewtransitions</code> into my global <code>Head.astro</code> component that I have on every page. I then added <code>&lt;ViewTransitions /&gt;</code> to the bottom of the <code>Head.astro</code> component. Here’s how that looks:</p><pre class="astro-code github-dark" style=background-color:#24292e;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d>---</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#f97583>import</span><span style=color:#e1e4e8> { ViewTransitions } </span><span style=color:#f97583>from</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>&quot;astrojs/viewtransitions&quot;</span><span style=color:#e1e4e8>;</span></span>
<span class=line><span style=color:#6a737d>---</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>&lt;</span><span style=color:#79b8ff>ViewTransitions</span><span style=color:#e1e4e8> /&gt;</span></span></code></pre><p>Astro has an implementation in Javascript for ViewTransitions that allows it to work on non chromium based browsers, but this did not seem to be working for me, so I had to adjust my <code>Head.astro</code> component to only render the ViewTransitions component if the browser is Chromium based. Here’s how that looks:</p><pre class="astro-code github-dark" style=background-color:#24292e;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d>---</span></span>
<span class=line><span style=color:#e1e4e8>  </span><span style=color:#f97583>import</span><span style=color:#e1e4e8> { ViewTransitions } </span><span style=color:#f97583>from</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>&quot;astrojs/viewtransitions&quot;</span><span style=color:#e1e4e8>;</span></span>
<span class=line><span style=color:#6a737d>---</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>&lt;</span><span style=color:#79b8ff>ViewTransitions</span><span style=color:#e1e4e8> </span><span style=color:#b392f0>fallback</span><span style=color:#e1e4e8>=</span><span style=color:#9ecbff>&#39;none&#39;</span><span style=color:#e1e4e8> /&gt;</span></span></code></pre><p>The <code>fallback</code> prop tells Astro to not render the ViewTransitions component if the browser is not Chromium based. This fixed the issue I was having with the ViewTransitions component not working on non Chromium based browsers.</p><p>I felt that just having ViewTransitions break on non chromium browsers was bad UX so I added a little warning to the footer of my website that tells the user that the transitions will not work on their browser.</p><p><em>PS: Astro’s ViewTransitions even respects the prefers-reduced-motion setting &amp; reduces motion when this is set</em></p><h2 id=image-optimizations>Image Optimizations</h2><p>Another change that I made to my website was to move all my images from <code>/public</code> to <code>/src</code> folder. This allowed me to take advantage of Astro’s built-in image optimization feature. Astro automatically optimizes and resizes your images based on the browser and device of your visitors. Essentially I don’t have to worry so much about manually optimizing my images for different devices and browsers. Astro does it for me.</p><p>There’s not really much to say about this other than I had to change most of how I display images because this broke most of my website. For example when you are on the <code>/blog/[...category].astro</code> page I have to take into acount that you are one level deeper in the relative path so I manually have to edit the path to the image. Here’s how that looks in my <code>[...category].astro</code> page:</p><pre class="astro-code github-dark" style=background-color:#24292e;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d>---</span></span>
<span class=line><span style=color:#6a737d>// Imports etc...</span></span>
<span class=line><span style=color:#6a737d>---</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>&lt;</span><span style=color:#79b8ff>MainLayout</span><span style=color:#e1e4e8> </span><span style=color:#b392f0>title</span><span style=color:#e1e4e8>={</span><span style=color:#9ecbff>`Posts about ${</span><span style=color:#e1e4e8>categoryName</span><span style=color:#9ecbff>}`</span><span style=color:#e1e4e8>}&gt;</span></span>
<span class=line><span style=color:#e1e4e8>  &lt;</span><span style=color:#85e89d>h1</span><span style=color:#e1e4e8> </span><span style=color:#b392f0>class</span><span style=color:#e1e4e8>=</span><span style=color:#9ecbff>&quot;mx-auto text-4xl text-center&quot;</span><span style=color:#e1e4e8>&gt;</span></span>
<span class=line><span style=color:#e1e4e8>    Posts about &lt;</span><span style=color:#85e89d>span</span><span style=color:#e1e4e8> </span><span style=color:#b392f0>class</span><span style=color:#e1e4e8>=</span><span style=color:#9ecbff>&quot;grad&quot;</span><span style=color:#e1e4e8>&gt;{categoryName}&lt;/</span><span style=color:#85e89d>span</span><span style=color:#e1e4e8>&gt;</span></span>
<span class=line><span style=color:#e1e4e8>  &lt;/</span><span style=color:#85e89d>h1</span><span style=color:#e1e4e8>&gt;</span></span>
<span class=line><span style=color:#e1e4e8>  {catPosts.</span><span style=color:#b392f0>map</span><span style=color:#e1e4e8>((</span><span style=color:#ffab70>post</span><span style=color:#e1e4e8>) </span><span style=color:#f97583>=&gt;</span><span style=color:#e1e4e8> {</span></span>
<span class=line><span style=color:#e1e4e8>    post.data.image.src </span><span style=color:#f97583>=</span><span style=color:#e1e4e8> (</span><span style=color:#9ecbff>&quot;../&quot;</span><span style=color:#e1e4e8> </span><span style=color:#f97583>+</span><span style=color:#e1e4e8> post.data.image.src);</span></span>
<span class=line><span style=color:#e1e4e8>    &lt;</span><span style=color:#79b8ff>PostCard</span><span style=color:#e1e4e8> {post} /&gt;</span></span>
<span class=line><span style=color:#e1e4e8>  })}</span></span>
<span class=line><span style=color:#e1e4e8>&lt;/</span><span style=color:#79b8ff>MainLayout</span><span style=color:#e1e4e8>&gt;</span></span></code></pre><h2 id=an-annoying-bug-finally-squashed>An Annoying Bug Finally Squashed 🐞</h2><p>I noticed that the scrollbar would shift the nav left and right when changing between a page that doesn’t scroll and a page that does. After a bit of <em>google-fu</em> I was able to fix this by editing my <code>global.css</code> and adding the following:</p><pre class="astro-code github-dark" style=background-color:#24292e;overflow-x:auto tabindex=0><code><span class=line><span style=color:#85e89d>html</span><span style=color:#e1e4e8> {</span></span>
<span class=line><span style=color:#e1e4e8>  </span><span style=color:#79b8ff>scrollbar-gutter</span><span style=color:#e1e4e8>: stable;</span></span>
<span class=line><span style=color:#e1e4e8>}</span></span></code></pre><p>This is a fairly new css property and it’s not supported by all browsers yet, but it’s supported by all the major browsers so I’m not too worried about it. This property ensures that a space is always reserved for the scrollbar gutter, even if the element is not overflowing. However, this only applies to classic scrollbars that consume space in the UI. Here’s the <a class="bg-clip-text bg-gradient-to-r from-notwhite hover:from-gradient1 hover:to-gradient2 link text-transparent to-notwhite" href=https://developer.mozilla.org/en-US/docs/Web/CSS/scrollbar-gutter target="target=&#34;_blank&#34;">MDN Web Docs</a> for more info.</p></div></div></div><footer class="text-center md:text-lg min-w-full py-10 sticky text-md top-[100vh]"><p><noscript class="font-bold text-xl">Javascript is disabled, you may face errors or strangeness. <a class="font-bold grad" href=https://www.enable-javascript.com>Enable it here.</a></noscript></p><p class=font-semibold><a class="bg-clip-text bg-gradient-to-r from-notwhite hover:from-gradient1 hover:to-gradient2 link text-transparent to-notwhite" href=https://imadam.io target="target=&#34;_blank&#34;">ImAdam.io</a> | Copyright &copy; <span id=copyright></span> | All rights reserved</p><p class=text-xs>Built using <a class="bg-clip-text bg-gradient-to-r from-notwhite hover:from-gradient1 hover:to-gradient2 link text-transparent to-notwhite" href=https://astro.build target="target=&#34;_blank&#34;">AstroJS</a> 🚀 & <a class="bg-clip-text bg-gradient-to-r from-notwhite hover:from-gradient1 hover:to-gradient2 link text-transparent to-notwhite" href=https://tailwindcss.com target="target=&#34;_blank&#34;">TailwindCSS</a>| Last updated 2023/11/12</p><p class="text-center mx-auto hidden max-w-sm text-xs" id=chrome-check><br>This site is best viewed in a chromium browser due to my use of <a class="bg-clip-text bg-gradient-to-r from-notwhite hover:from-gradient1 hover:to-gradient2 link text-transparent to-notwhite font-bold" href=https://caniuse.com/mdn-api_viewtransition target="target=&#34;_blank&#34;">ViewTransitions</a> for seamless page navigation. During the next page refresh I will hide this message until the browser is closed. :)</p></footer></body></html>