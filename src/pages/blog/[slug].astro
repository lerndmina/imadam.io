---
import { getCollection, CollectionEntry } from "astro:content";
import { Image } from "@astrojs/image/components";
// component import
import MainLayout from "../../layouts/MainLayout.astro";
import Link from "../../components/Link.astro";
// util imports
import { formatBlogPosts, slugify, formatDate } from "../../js/utils";
export async function getStaticPaths() {
  const allPosts = await getCollection("blog");
  const formattedPosts = formatBlogPosts(allPosts);
  return formattedPosts.map((post) => ({
    params: { slug: post.slug },
    props: {
      post,
    },
  }));
}
interface Props {
  post: CollectionEntry<"blog">;
}
const { post } = Astro.props;
const { title, description, date, category, author, image } = post.data;
const imageRatio = image.aspect_ratio.x / image.aspect_ratio.y;
const { Content } = await post.render();
// const allPosts = await getCollection("blog");
// const formattedPosts = formatBlogPosts(allPosts, {
//   sortByDate: false,
// });
---

<MainLayout title={title} description={description}>
  <div class="max-w-4xl m-auto">
    <header>
      <div class="mx-auto pb-10 container text-center">
        <h1 class="text-5xl pb-1">{title}</h1>
        <p class="text-md">
          by <Link href={`/blog/author/${slugify(author)}/`} text={author} /> â€¢ {formatDate(date)}
        </p>
        <small class="text-sm">
          <Link href={`/blog/category/${slugify(category)}/`} text={`# ${category}`} />
        </small>
      </div>
    </header>
    <div class="flex justify-center rounded-md overflow-hidden mx-auto p-10 pt-20">
      <Image class="drop-shadow-lg" src={image.src} alt={image.alt} width={800} height={700 / imageRatio} aspectRatio={imageRatio} format={"avif"} fit={"cover"} title={image.alt} />
    </div>
    <div class="flex justify-center sm:px-8 px-16">
      <div class="content prose prose-invert">
        <!-- ! Page content goes here -->
        <Content />
      </div>
    </div>
  </div>
</MainLayout>
