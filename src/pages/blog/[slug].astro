---
import { getCollection, CollectionEntry } from "astro:content";
import { Image } from "@astrojs/image/components";
// component import
import MainLayout from "../../layouts/MainLayout.astro";
import Link from "../../components/Link.astro";
// util imports
import { formatBlogPosts, slugify, formatDate } from "../../js/utils";
export async function getStaticPaths() {
  const allPosts = await getCollection("blog");
  const formattedPosts = formatBlogPosts(allPosts);
  return formattedPosts.map((post) => ({
    params: { slug: post.slug },
    props: {
      post,
    },
  }));
}
interface Props {
  post: CollectionEntry<"blog">;
}
const { post } = Astro.props;
const { title, description, date, category, author, image } = post.data;
const { Content } = await post.render();
const allPosts = await getCollection("blog");
const formattedPosts = formatBlogPosts(allPosts, {
  sortByDate: false,
});
---

<MainLayout title={title} description={description}>
  <div class="max-w-4xl m-auto">
    <header>
      <div class="mx-auto pb-10 container text-center">
        <small class="text-lg">
          <Link
            href={`/blog/category/${slugify(category)}/`}
            text={`Category: ${category}`}
          />
        </small>
        <h1 class="text-2xl">{title}</h1>
        <p class="text-xl">
          by <Link href={`/blog/author/${slugify(author)}/`} text={author} /> â€¢ {
            formatDate(date)
          }
        </p>
      </div>
      <div class="rounded-md overflow-hidden">
        <Image
          class="sm:px-8 md:px-16 pb-10 drop-shadow-lg"
          src={image.src}
          alt={image.alt}
          width={1200}
          height={600}
          format={"avif"}
          fit={"cover"}
        />
      </div>
    </header>
    <div class="post-content sm:px-8 px-16">
      <div class="content prose prose-invert">
        <!-- ! Page content goes here -->
        <Content />
      </div>
    </div>
  </div>
</MainLayout>
